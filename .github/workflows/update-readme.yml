name: Update README

on:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —â–æ–¥–Ω—è –æ 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch: # –î–æ–∑–≤–æ–ª—è—î –∑–∞–ø—É—Å–∫–∞—Ç–∏ –≤—Ä—É—á–Ω—É
  push:
    branches: [ main ]

jobs:
  update-readme:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Update README
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        # –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω—É –¥–∞—Ç—É —Ç–∞ —á–∞—Å
        current_date=$(date +'%d.%m.%Y')
        current_time=$(date +'%H:%M:%S UTC')
        
        # –û—Ç—Ä–∏–º—É—î–º–æ —Ä–∞–Ω–¥–æ–º–Ω—É —Ü–∏—Ç–∞—Ç—É
        quote=$(curl -s "https://api.quotable.io/random" | grep -o '"content":"[^"]*' | sed 's/"content":"//')
        
        # –û—Ç—Ä–∏–º—É—î–º–æ GitHub —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        github_user="${{ github.repository_owner }}"
        
        # –û—Ç—Ä–∏–º—É—î–º–æ –∑–∞–≥–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–æ–º—ñ—Ç—ñ–≤
        total_commits=$(curl -s "https://api.github.com/search/commits?q=author:$github_user" | grep -o '"total_count":[^,]*' | sed 's/"total_count"://')
        
        # –û—Ç—Ä–∏–º—É—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó
        repo_stats=$(curl -s "https://api.github.com/users/$github_user")
        public_repos=$(echo $repo_stats | grep -o '"public_repos":[^,]*' | sed 's/"public_repos"://')
        
        # –û–Ω–æ–≤–ª—é—î–º–æ README.md
        sed -i "s/{CURRENT_DATE}/$current_date/g" README.md
        sed -i "s/{CURRENT_TIME}/$current_time/g" README.md
        sed -i "s/{QUOTE_OF_DAY}/$quote/g" README.md
        sed -i "s/{TOTAL_COMMITS}/$total_commits/g" README.md
        sed -i "s/{PUBLIC_REPOS}/$public_repos/g" README.md
        sed -i "s/YOUR_USERNAME/$github_user/g" README.md
        
        # –î–æ–¥–∞—î–º–æ –∑–º—ñ–Ω–∏ –¥–æ git
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add README.md
        git diff --staged --quiet || git commit -m "ü§ñ Auto update README - $(date +'%Y-%m-%d %H:%M:%S')"
        git push
